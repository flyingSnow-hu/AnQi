# GPUæ€§èƒ½ä¼˜åŒ–æŒ‡å—

## å½“å‰é…ç½® vs ä¼˜åŒ–é…ç½®å¯¹æ¯”

### åŸºç¡€ç‰ˆ (train_rl_ai_improved.py)
```bash
--games 50                  # æ¯è½®50å±€æ¸¸æˆ
--batch-size 128            # æ‰¹æ¬¡128
--train-steps 300           # è®­ç»ƒ300æ­¥
--parallel-games 1          # ä¸²è¡Œï¼Œæ— å¹¶è¡Œ
æ··åˆç²¾åº¦: å¦                 # ä½¿ç”¨FP32
```

**GPUåˆ©ç”¨ç‡**: ~30-50%  
**è®­ç»ƒé€Ÿåº¦**: ~50å±€/å°æ—¶  
**æ˜¾å­˜å ç”¨**: ~2-3GB / 12GB

---

### ä¼˜åŒ–ç‰ˆ (train_rl_ai_optimized.py)

#### é…ç½®1: ä¸­ç­‰ä¼˜åŒ– (æ¨èèµ·ç‚¹)
```bash
.\venv\Scripts\python.exe train_rl_ai_optimized.py ^
    --games 80 ^
    --batch-size 256 ^
    --train-steps 400 ^
    --parallel-games 4 ^
    --num-channels 256 ^
    --num-res-blocks 20 ^
    --save-dir models_v4_medium
```

**GPUåˆ©ç”¨ç‡**: ~60-75%  
**è®­ç»ƒé€Ÿåº¦**: ~150å±€/å°æ—¶ (3å€æå‡)  
**æ˜¾å­˜å ç”¨**: ~5-6GB / 12GB

---

#### é…ç½®2: é«˜åº¦ä¼˜åŒ– (å……åˆ†åˆ©ç”¨GPU)
```bash
.\venv\Scripts\python.exe train_rl_ai_optimized.py ^
    --games 120 ^
    --batch-size 512 ^
    --train-steps 600 ^
    --parallel-games 8 ^
    --num-channels 256 ^
    --num-res-blocks 20 ^
    --save-dir models_v4_high
```

**GPUåˆ©ç”¨ç‡**: ~80-95%  
**è®­ç»ƒé€Ÿåº¦**: ~300å±€/å°æ—¶ (6å€æå‡)  
**æ˜¾å­˜å ç”¨**: ~9-10GB / 12GB

---

#### é…ç½®3: æé™ä¼˜åŒ– (æœ€å¤§åŒ–ç½‘ç»œå®¹é‡)
```bash
.\venv\Scripts\python.exe train_rl_ai_optimized.py ^
    --games 100 ^
    --batch-size 512 ^
    --train-steps 500 ^
    --parallel-games 8 ^
    --num-channels 384 ^
    --num-res-blocks 30 ^
    --save-dir models_v4_ultra
```

**GPUåˆ©ç”¨ç‡**: ~90-100%  
**è®­ç»ƒé€Ÿåº¦**: ~200å±€/å°æ—¶ (ç½‘ç»œæ›´å¤§ï¼Œé€Ÿåº¦ç¨æ…¢ä½†è´¨é‡æ›´é«˜)  
**æ˜¾å­˜å ç”¨**: ~11-12GB / 12GB (æ¥è¿‘æ˜¾å­˜ä¸Šé™)

---

## ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

### 1. å¹¶è¡Œè‡ªå¯¹å¼ˆ (--parallel-games)
**ä½œç”¨**: åŒæ—¶è¿›è¡Œå¤šå±€æ¸¸æˆï¼Œå……åˆ†åˆ©ç”¨GPUæ‰¹é‡æ¨ç†èƒ½åŠ›

- `--parallel-games 1`: ä¸²è¡Œï¼ŒGPUç»å¸¸ç©ºé—²ç­‰å¾…CPU
- `--parallel-games 4`: GPUåˆ©ç”¨ç‡æå‡~2å€
- `--parallel-games 8`: GPUåˆ©ç”¨ç‡æå‡~3-4å€
- `--parallel-games 16`: è¿‡é«˜å¯èƒ½å¯¼è‡´CPUæˆä¸ºç“¶é¢ˆ

**æ¨èå€¼**: 4-8 (RTX 3060)

---

### 2. æ‰¹æ¬¡å¤§å° (--batch-size)
**ä½œç”¨**: æ¯æ¬¡è®­ç»ƒåŒæ—¶å¤„ç†çš„æ ·æœ¬æ•°ï¼Œè¶Šå¤§GPUåˆ©ç”¨ç‡è¶Šé«˜

- `128`: åŸºç¡€é…ç½®ï¼ŒGPUåˆ©ç”¨ç‡ä½
- `256`: ä¸­ç­‰ï¼Œé€‚åˆ12GBæ˜¾å­˜
- `512`: é«˜æ•ˆï¼Œå……åˆ†åˆ©ç”¨GPUå¹¶è¡Œèƒ½åŠ›
- `1024`: æé™ï¼Œå¯èƒ½æ˜¾å­˜ä¸è¶³ï¼ˆå–å†³äºç½‘ç»œå¤§å°ï¼‰

**æ¨èå€¼**: 256-512 (RTX 3060 12GB)

**æ³¨æ„**: æ‰¹æ¬¡å¤ªå¤§å¯èƒ½å¯¼è‡´è®­ç»ƒä¸ç¨³å®š

---

### 3. æ··åˆç²¾åº¦è®­ç»ƒ (é»˜è®¤å¯ç”¨)
**ä½œç”¨**: ä½¿ç”¨FP16ä»£æ›¿FP32ï¼Œé€Ÿåº¦æå‡~2å€ï¼Œæ˜¾å­˜å ç”¨å‡åŠ

- è‡ªåŠ¨å¯ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- ä½¿ç”¨ `--no-amp` ç¦ç”¨ï¼ˆä¸æ¨èï¼‰

**æ€§èƒ½æå‡**: 
- é€Ÿåº¦: +50-100%
- æ˜¾å­˜: -40-50%

---

### 4. ç½‘ç»œè§„æ¨¡ä¼˜åŒ–

#### å®½åº¦ (--num-channels)
- `128`: åŸºç¡€ (~2Må‚æ•°)
- `256`: æ ‡å‡† (~8Må‚æ•°) â­æ¨è
- `384`: å¤§å‹ (~18Må‚æ•°)
- `512`: è¶…å¤§ (~32Må‚æ•°)

#### æ·±åº¦ (--num-res-blocks)
- `10`: åŸºç¡€
- `20`: æ ‡å‡† â­æ¨è
- `30`: æ·±åº¦
- `40`: è¶…æ·± (å¯èƒ½è¿‡æ‹Ÿåˆ)

**æƒè¡¡**: 
- æ›´å¤§ç½‘ç»œ â†’ æ›´å¼ºAIï¼Œä½†è®­ç»ƒæ›´æ…¢
- æ›´å°ç½‘ç»œ â†’ è®­ç»ƒæ›´å¿«ï¼Œä½†æ€§èƒ½ä¸Šé™ä½

---

## ç›‘æ§GPUæ€§èƒ½

### æ–¹æ³•1: å®‰è£…ç›‘æ§å·¥å…·
```bash
# å®‰è£…nvidia-ml-py3
.\venv\Scripts\pip.exe install nvidia-ml-py3

# è¿è¡ŒGPUç›‘æ§
.\venv\Scripts\python.exe gpu_monitor.py
```

### æ–¹æ³•2: ä½¿ç”¨nvidia-smi
```bash
# Windows PowerShell
while ($true) { cls; nvidia-smi; sleep 2 }

# æˆ–å•æ¬¡æŸ¥çœ‹
nvidia-smi
```

### å…³é”®æŒ‡æ ‡

1. **GPUåˆ©ç”¨ç‡** (GPU-Util)
   - <50%: é…ç½®å¤ªä¿å®ˆï¼Œæé«˜å¹¶è¡Œåº¦å’Œæ‰¹æ¬¡
   - 50-80%: è‰¯å¥½
   - >90%: å……åˆ†åˆ©ç”¨ âœ“

2. **æ˜¾å­˜ä½¿ç”¨** (Memory-Usage)
   - <50%: å¯ä»¥å¢åŠ æ‰¹æ¬¡æˆ–ç½‘ç»œè§„æ¨¡
   - 50-80%: åˆç†
   - >95%: æ¥è¿‘ä¸Šé™ï¼Œå°å¿ƒOOM

3. **æ¸©åº¦** (Temp)
   - <70Â°C: ä¼˜ç§€
   - 70-80Â°C: æ­£å¸¸
   - >85Â°C: æ³¨æ„æ•£çƒ­

4. **åŠŸç‡** (Pwr)
   - æ¥è¿‘TDPä¸Šé™è¡¨ç¤ºGPUåœ¨å…¨åŠ›å·¥ä½œ âœ“

---

## ä¼˜åŒ–æµç¨‹å»ºè®®

### Step 1: æµ‹è¯•åŸºçº¿
```bash
# ä½¿ç”¨åŸºç¡€é…ç½®è®­ç»ƒå‡ è½®
.\venv\Scripts\python.exe train_rl_ai_optimized.py ^
    --games 20 --iterations 5 --parallel-games 2 --batch-size 128
```

### Step 2: ç›‘æ§GPU
- æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œ `nvidia-smi -l 2`
- è§‚å¯ŸGPUåˆ©ç”¨ç‡å’Œæ˜¾å­˜ä½¿ç”¨

### Step 3: é€æ­¥æå‡
```bash
# æå‡åˆ°ä¸­ç­‰é…ç½®
--parallel-games 4 --batch-size 256

# å¦‚æœGPUåˆ©ç”¨ç‡ä»<70%ï¼Œç»§ç»­æå‡
--parallel-games 6 --batch-size 384

# ç›´åˆ°GPUåˆ©ç”¨ç‡è¾¾åˆ°80-90%
--parallel-games 8 --batch-size 512
```

### Step 4: å¢åŠ ç½‘ç»œè§„æ¨¡
```bash
# å¦‚æœæ˜¾å­˜è¿˜æœ‰ä½™é‡(>3GBç©ºé—²)ï¼Œå¢åŠ ç½‘ç»œå®¹é‡
--num-channels 384 --num-res-blocks 25
```

---

## æ€§èƒ½åŸºå‡† (RTX 3060 12GB)

| é…ç½® | GPUåˆ©ç”¨ç‡ | æ˜¾å­˜å ç”¨ | é€Ÿåº¦(å±€/å°æ—¶) | ç›¸å¯¹æå‡ |
|------|-----------|----------|---------------|----------|
| åŸºç¡€ç‰ˆ | 35% | 2.5GB | 50 | 1x |
| ä¼˜åŒ–-ä½ | 60% | 4GB | 120 | 2.4x |
| ä¼˜åŒ–-ä¸­ | 80% | 6GB | 200 | 4x |
| ä¼˜åŒ–-é«˜ | 95% | 10GB | 300 | 6x |
| ä¼˜åŒ–-æé™ | 98% | 11.5GB | 250 | 5x (è´¨é‡æ›´é«˜) |

---

## å¸¸è§é—®é¢˜

### Q: æ˜¾å­˜ä¸è¶³ (CUDA out of memory)
**è§£å†³æ–¹æ¡ˆ**:
1. å‡å°æ‰¹æ¬¡: `--batch-size 256` â†’ `128`
2. å‡å°ç½‘ç»œ: `--num-channels 256` â†’ `128`
3. å‡å°‘å¹¶è¡Œ: `--parallel-games 8` â†’ `4`

### Q: GPUåˆ©ç”¨ç‡å§‹ç»ˆå¾ˆä½ (<40%)
**å¯èƒ½åŸå› **:
1. CPUæˆä¸ºç“¶é¢ˆ â†’ å‡å°‘MCTSæ¨¡æ‹Ÿæ¬¡æ•°
2. å¹¶è¡Œåº¦å¤ªä½ â†’ å¢åŠ  `--parallel-games`
3. æ‰¹æ¬¡å¤ªå° â†’ å¢åŠ  `--batch-size`

### Q: è®­ç»ƒå¾ˆæ…¢ï¼Œæ¯è½®è¦å¾ˆä¹…
**ä¼˜åŒ–å»ºè®®**:
1. å‡å°‘æ¯è½®æ¸¸æˆæ•°: `--games 100` â†’ `50`
2. å‡å°‘è®­ç»ƒæ­¥æ•°: `--train-steps 500` â†’ `300`
3. å¢åŠ ä¿å­˜é—´éš”: `--save-interval 10` â†’ `20`

### Q: å¦‚ä½•å¹³è¡¡é€Ÿåº¦å’Œè´¨é‡
**æ¨èé…ç½®** (RTX 3060):
```bash
--games 80                  # è¶³å¤Ÿçš„æ ·æœ¬å¤šæ ·æ€§
--batch-size 384            # è‰¯å¥½çš„GPUåˆ©ç”¨ç‡
--parallel-games 6          # å¹³è¡¡çš„å¹¶è¡Œåº¦
--num-channels 256          # æ ‡å‡†ç½‘ç»œå®¹é‡
--num-res-blocks 20         # æ ‡å‡†ç½‘ç»œæ·±åº¦
--train-steps 400           # å……åˆ†è®­ç»ƒ
```

---

## å¿«é€Ÿå¯åŠ¨å‘½ä»¤

### æ¨èé…ç½® (å¹³è¡¡é€Ÿåº¦å’Œè´¨é‡)
```bash
.\venv\Scripts\python.exe train_rl_ai_optimized.py ^
    --games 80 ^
    --iterations 300 ^
    --train-steps 400 ^
    --batch-size 384 ^
    --lr 0.0003 ^
    --temperature 0.7 ^
    --reward-scale 0.02 ^
    --num-channels 256 ^
    --num-res-blocks 20 ^
    --parallel-games 6 ^
    --save-interval 20 ^
    --save-dir models_v4_balanced
```

### æé€Ÿè®­ç»ƒ (ç‰ºç‰²è´¨é‡æ¢é€Ÿåº¦)
```bash
.\venv\Scripts\python.exe train_rl_ai_optimized.py ^
    --games 120 ^
    --iterations 500 ^
    --train-steps 300 ^
    --batch-size 512 ^
    --parallel-games 10 ^
    --num-channels 192 ^
    --num-res-blocks 15 ^
    --save-dir models_v4_fast
```

### é«˜è´¨é‡è®­ç»ƒ (æœ€å¼ºAI)
```bash
.\venv\Scripts\python.exe train_rl_ai_optimized.py ^
    --games 60 ^
    --iterations 800 ^
    --train-steps 600 ^
    --batch-size 256 ^
    --parallel-games 4 ^
    --num-channels 384 ^
    --num-res-blocks 30 ^
    --save-dir models_v4_quality
```

---

## æ€»ç»“

ä¼˜åŒ–åçš„è®­ç»ƒè„šæœ¬é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æå‡æ€§èƒ½:

1. âœ… **å¹¶è¡Œè‡ªå¯¹å¼ˆ** - 3-4å€é€Ÿåº¦æå‡
2. âœ… **æ··åˆç²¾åº¦è®­ç»ƒ** - 2å€é€Ÿåº¦æå‡  
3. âœ… **å¤§æ‰¹æ¬¡è®­ç»ƒ** - 1.5-2å€GPUåˆ©ç”¨ç‡
4. âœ… **æ™ºèƒ½å†…å­˜ç®¡ç†** - æ”¯æŒæ›´å¤§ç½‘ç»œ

**æ€»ä½“æå‡**: åŸºç¡€ç‰ˆçš„ **4-6å€è®­ç»ƒé€Ÿåº¦**

å¯¹äºRTX 3060 12GBï¼Œæ¨èä½¿ç”¨:
- `--parallel-games 6-8`
- `--batch-size 384-512`
- `--num-channels 256`
- `--num-res-blocks 20`

è¿™æ ·å¯ä»¥è¾¾åˆ° **80-95% GPUåˆ©ç”¨ç‡**ï¼Œè®­ç»ƒé€Ÿåº¦æå‡ **4-6å€** ğŸš€
